package vistas;

import comercio.ControllerSingleton;
import controladoresJPA.ProductoJpaController;
import controladoresJPA.exceptions.CampoIncompletoException;
import controladoresJPA.exceptions.CodigoProductoNoRegistradoException;
import modelo.Categoria;
import modelo.Marca;
import javax.swing.JOptionPane;

/**
 *
 * @author Mauro Federico Lopez
 */
public class ModificarPrecioUI extends javax.swing.JPanel {

    private ProductoJpaController productoJpaController;

    /**
     * Creates new form ModificarPrecioUI
     */
    public ModificarPrecioUI() {
        initComponents();
        productoJpaController = ControllerSingleton.getProductoJpaController();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        panelModificarPrecioProducto = new javax.swing.JPanel();
        etiquetaProducto = new javax.swing.JLabel();
        campoCodigoProducto = new javax.swing.JTextField();
        etiquetaPorcentajeProducto = new javax.swing.JLabel();
        botonModificarPrecioProducto = new javax.swing.JButton();
        jLabel2 = new javax.swing.JLabel();
        campoPorcentajeProducto = new javax.swing.JFormattedTextField();
        panelModificarPrecioCategoria = new javax.swing.JPanel();
        etiquetaCategoria = new javax.swing.JLabel();
        campoCategoria = new javax.swing.JComboBox();
        etiquetaPorcentajeCategoria = new javax.swing.JLabel();
        botonModificarPrecioCategoria = new javax.swing.JButton();
        jLabel1 = new javax.swing.JLabel();
        campoPorcentajeCategoria = new javax.swing.JFormattedTextField();
        panelModificarPrecioMarca = new javax.swing.JPanel();
        etiquetaMarca = new javax.swing.JLabel();
        campoMarca = new javax.swing.JComboBox();
        etiquetaPorcentajeMarca = new javax.swing.JLabel();
        botonModificarPrecioMarca = new javax.swing.JButton();
        jLabel3 = new javax.swing.JLabel();
        campoPorcentajeMarca = new javax.swing.JFormattedTextField();

        setMaximumSize(new java.awt.Dimension(900, 500));
        setMinimumSize(new java.awt.Dimension(900, 500));
        setLayout(new java.awt.BorderLayout());

        panelModificarPrecioProducto.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Modificar precio por porcentaje de un producto", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 14))); // NOI18N
        panelModificarPrecioProducto.setMaximumSize(new java.awt.Dimension(900, 160));
        panelModificarPrecioProducto.setMinimumSize(new java.awt.Dimension(900, 160));
        panelModificarPrecioProducto.setPreferredSize(new java.awt.Dimension(900, 160));

        etiquetaProducto.setText("Ingrese código del producto");

        etiquetaPorcentajeProducto.setText("Indique porcentaje");

        botonModificarPrecioProducto.setText("Modificar Precio de la Categoría");
        botonModificarPrecioProducto.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonModificarPrecioProductoActionPerformed(evt);
            }
        });

        jLabel2.setText("(Ej. 15%)");

        campoPorcentajeProducto.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.NumberFormatter(java.text.NumberFormat.getPercentInstance())));

        javax.swing.GroupLayout panelModificarPrecioProductoLayout = new javax.swing.GroupLayout(panelModificarPrecioProducto);
        panelModificarPrecioProducto.setLayout(panelModificarPrecioProductoLayout);
        panelModificarPrecioProductoLayout.setHorizontalGroup(
            panelModificarPrecioProductoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelModificarPrecioProductoLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(panelModificarPrecioProductoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addGroup(panelModificarPrecioProductoLayout.createSequentialGroup()
                        .addGroup(panelModificarPrecioProductoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(etiquetaProducto, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(etiquetaPorcentajeProducto, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(panelModificarPrecioProductoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(campoCodigoProducto, javax.swing.GroupLayout.DEFAULT_SIZE, 174, Short.MAX_VALUE)
                            .addComponent(campoPorcentajeProducto)))
                    .addComponent(botonModificarPrecioProducto, javax.swing.GroupLayout.DEFAULT_SIZE, 312, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 91, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(471, Short.MAX_VALUE))
        );
        panelModificarPrecioProductoLayout.setVerticalGroup(
            panelModificarPrecioProductoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelModificarPrecioProductoLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(panelModificarPrecioProductoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(etiquetaProducto)
                    .addComponent(campoCodigoProducto, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(panelModificarPrecioProductoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(etiquetaPorcentajeProducto)
                    .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 20, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(campoPorcentajeProducto, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(botonModificarPrecioProducto)
                .addContainerGap(48, Short.MAX_VALUE))
        );

        add(panelModificarPrecioProducto, java.awt.BorderLayout.PAGE_START);

        panelModificarPrecioCategoria.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Modificar precio por porcentaje de los productos de una categoría", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 14))); // NOI18N
        panelModificarPrecioCategoria.setMaximumSize(new java.awt.Dimension(900, 160));
        panelModificarPrecioCategoria.setMinimumSize(new java.awt.Dimension(900, 160));
        panelModificarPrecioCategoria.setPreferredSize(new java.awt.Dimension(900, 160));

        etiquetaCategoria.setText("Seleccione una categoría");

        campoCategoria.setModel(new vistas.modelos.CategoriaComboBoxModel());

        etiquetaPorcentajeCategoria.setText("Indique porcentaje");

        botonModificarPrecioCategoria.setText("Modificar Precio de la Categoría");
        botonModificarPrecioCategoria.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonModificarPrecioCategoriaActionPerformed(evt);
            }
        });

        jLabel1.setText("(Ej. 15%)");

        campoPorcentajeCategoria.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.NumberFormatter(java.text.NumberFormat.getPercentInstance())));

        javax.swing.GroupLayout panelModificarPrecioCategoriaLayout = new javax.swing.GroupLayout(panelModificarPrecioCategoria);
        panelModificarPrecioCategoria.setLayout(panelModificarPrecioCategoriaLayout);
        panelModificarPrecioCategoriaLayout.setHorizontalGroup(
            panelModificarPrecioCategoriaLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelModificarPrecioCategoriaLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(panelModificarPrecioCategoriaLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addGroup(panelModificarPrecioCategoriaLayout.createSequentialGroup()
                        .addGroup(panelModificarPrecioCategoriaLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(etiquetaPorcentajeCategoria, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(etiquetaCategoria, javax.swing.GroupLayout.DEFAULT_SIZE, 139, Short.MAX_VALUE))
                        .addGap(10, 10, 10)
                        .addGroup(panelModificarPrecioCategoriaLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(campoCategoria, 0, 174, Short.MAX_VALUE)
                            .addComponent(campoPorcentajeCategoria)))
                    .addComponent(botonModificarPrecioCategoria, javax.swing.GroupLayout.DEFAULT_SIZE, 323, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 91, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(460, Short.MAX_VALUE))
        );
        panelModificarPrecioCategoriaLayout.setVerticalGroup(
            panelModificarPrecioCategoriaLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelModificarPrecioCategoriaLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(panelModificarPrecioCategoriaLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(campoCategoria, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(etiquetaCategoria))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(panelModificarPrecioCategoriaLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(etiquetaPorcentajeCategoria)
                    .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 20, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(campoPorcentajeCategoria, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(botonModificarPrecioCategoria)
                .addContainerGap(48, Short.MAX_VALUE))
        );

        add(panelModificarPrecioCategoria, java.awt.BorderLayout.CENTER);

        panelModificarPrecioMarca.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Modificar precio por porcentaje de los productos de una marca", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 14))); // NOI18N
        panelModificarPrecioMarca.setMaximumSize(new java.awt.Dimension(900, 160));
        panelModificarPrecioMarca.setMinimumSize(new java.awt.Dimension(900, 160));

        etiquetaMarca.setText("Seleccione una marca");

        campoMarca.setModel(new vistas.modelos.CategoriaComboBoxModel());

        etiquetaPorcentajeMarca.setText("Indique porcentaje");

        botonModificarPrecioMarca.setText("Modificar Precio de la Categoría");
        botonModificarPrecioMarca.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonModificarPrecioMarcaActionPerformed(evt);
            }
        });

        jLabel3.setText("(Ej. 15%)");

        campoPorcentajeMarca.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.NumberFormatter(java.text.NumberFormat.getPercentInstance())));

        javax.swing.GroupLayout panelModificarPrecioMarcaLayout = new javax.swing.GroupLayout(panelModificarPrecioMarca);
        panelModificarPrecioMarca.setLayout(panelModificarPrecioMarcaLayout);
        panelModificarPrecioMarcaLayout.setHorizontalGroup(
            panelModificarPrecioMarcaLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelModificarPrecioMarcaLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(panelModificarPrecioMarcaLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addGroup(panelModificarPrecioMarcaLayout.createSequentialGroup()
                        .addGroup(panelModificarPrecioMarcaLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(etiquetaMarca, javax.swing.GroupLayout.DEFAULT_SIZE, 122, Short.MAX_VALUE)
                            .addComponent(etiquetaPorcentajeMarca, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(panelModificarPrecioMarcaLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(campoMarca, 0, 174, Short.MAX_VALUE)
                            .addComponent(campoPorcentajeMarca)))
                    .addComponent(botonModificarPrecioMarca, javax.swing.GroupLayout.DEFAULT_SIZE, 312, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jLabel3, javax.swing.GroupLayout.PREFERRED_SIZE, 91, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(471, Short.MAX_VALUE))
        );
        panelModificarPrecioMarcaLayout.setVerticalGroup(
            panelModificarPrecioMarcaLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelModificarPrecioMarcaLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(panelModificarPrecioMarcaLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(campoMarca, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(etiquetaMarca))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(panelModificarPrecioMarcaLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(etiquetaPorcentajeMarca)
                    .addComponent(jLabel3, javax.swing.GroupLayout.PREFERRED_SIZE, 20, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(campoPorcentajeMarca, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(botonModificarPrecioMarca)
                .addContainerGap(74, Short.MAX_VALUE))
        );

        add(panelModificarPrecioMarca, java.awt.BorderLayout.PAGE_END);
    }// </editor-fold>//GEN-END:initComponents

    private void botonModificarPrecioProductoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_botonModificarPrecioProductoActionPerformed
        try {
            camposModificarPrecioProductoCompletos();
            String codigoProducto = campoCodigoProducto.getText();
            Double porcentaje = ((Number) campoPorcentajeProducto.getValue()).doubleValue();
            productoJpaController.modificarPrecioProducto(codigoProducto, porcentaje);
            JOptionPane.showMessageDialog(null, "Se ha completó la operación.", "Enhorabuena", JOptionPane.INFORMATION_MESSAGE);
            campoCodigoProducto.setText("");
            campoPorcentajeProducto.setValue(null);
        } catch(CampoIncompletoException ex) {
            ex.mostrarDialogo();
        } catch (CodigoProductoNoRegistradoException ex) {
            ex.mostrarDialogo();
        } catch (Exception ex) {
            JOptionPane.showMessageDialog(null, ex.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);
        }
    }//GEN-LAST:event_botonModificarPrecioProductoActionPerformed

    private void botonModificarPrecioCategoriaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_botonModificarPrecioCategoriaActionPerformed
        try {
            camposModificarPrecioCategoriaCompletos();
            Categoria categoria = (Categoria) campoCategoria.getSelectedItem();
            Double porcentaje = ((Number) campoPorcentajeCategoria.getValue()).doubleValue();
            productoJpaController.modificarPrecioCategoria(categoria, porcentaje);
            JOptionPane.showMessageDialog(null, "Se ha completó la operación.", "Enhorabuena", JOptionPane.INFORMATION_MESSAGE);
            campoCategoria.setSelectedItem(null);
            campoPorcentajeCategoria.setValue(null);
        } catch(CampoIncompletoException ex) {
            ex.mostrarDialogo();
        } catch (Exception ex) {
            JOptionPane.showMessageDialog(null, ex.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);
        }
    }//GEN-LAST:event_botonModificarPrecioCategoriaActionPerformed

    private void botonModificarPrecioMarcaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_botonModificarPrecioMarcaActionPerformed
        try {
            camposModificarPrecioMarcaCompletos();
            Marca marca = (Marca) campoMarca.getSelectedItem();
            Double porcentaje = ((Number) campoPorcentajeMarca.getValue()).doubleValue();
            productoJpaController.modificarPrecioMarca(marca, porcentaje);
            JOptionPane.showMessageDialog(null, "Se ha completó la operación.", "Enhorabuena", JOptionPane.INFORMATION_MESSAGE);
            campoMarca.setSelectedItem(null);
            campoPorcentajeMarca.setValue(null);
        } catch(CampoIncompletoException ex) {
            ex.mostrarDialogo();
        } catch (Exception ex) {
            JOptionPane.showMessageDialog(null, ex.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);
        }
    }//GEN-LAST:event_botonModificarPrecioMarcaActionPerformed

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton botonModificarPrecioCategoria;
    private javax.swing.JButton botonModificarPrecioMarca;
    private javax.swing.JButton botonModificarPrecioProducto;
    private javax.swing.JComboBox campoCategoria;
    private javax.swing.JTextField campoCodigoProducto;
    private javax.swing.JComboBox campoMarca;
    private javax.swing.JFormattedTextField campoPorcentajeCategoria;
    private javax.swing.JFormattedTextField campoPorcentajeMarca;
    private javax.swing.JFormattedTextField campoPorcentajeProducto;
    private javax.swing.JLabel etiquetaCategoria;
    private javax.swing.JLabel etiquetaMarca;
    private javax.swing.JLabel etiquetaPorcentajeCategoria;
    private javax.swing.JLabel etiquetaPorcentajeMarca;
    private javax.swing.JLabel etiquetaPorcentajeProducto;
    private javax.swing.JLabel etiquetaProducto;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JPanel panelModificarPrecioCategoria;
    private javax.swing.JPanel panelModificarPrecioMarca;
    private javax.swing.JPanel panelModificarPrecioProducto;
    // End of variables declaration//GEN-END:variables

    private void camposModificarPrecioProductoCompletos() throws CampoIncompletoException {
        if(campoCodigoProducto.getText().isEmpty())
            throw new CampoIncompletoException("No ha indicado el código del producto");
        if(campoPorcentajeProducto.getValue() == null)
            throw new CampoIncompletoException("No ha indicado el precio.");
    }

    private void camposModificarPrecioCategoriaCompletos() throws CampoIncompletoException {
        if(campoCategoria.getSelectedItem() == null)
            throw new CampoIncompletoException("No ha indicado una categoría");
        if(campoPorcentajeCategoria.getValue() == null)
            throw new CampoIncompletoException("No ha indicado el precio.");
    }

    private void camposModificarPrecioMarcaCompletos() throws CampoIncompletoException {
        if(campoMarca.getSelectedItem() == null)
            throw new CampoIncompletoException("No ha indicado una categoría");
        if(campoPorcentajeMarca.getValue() == null)
            throw new CampoIncompletoException("No ha indicado el precio.");
    }

}
