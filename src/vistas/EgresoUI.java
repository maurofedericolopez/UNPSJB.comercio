package vistas;

import controladoresJPA.EgresoJpaController;
import java.awt.event.ItemEvent;
import java.util.ArrayList;
import javax.swing.JOptionPane;
import modelo.Almacen;
import modelo.LoteEgresado;
import vistas.modelos.LoteEgresadoTableModel;

/**
 *
 * @author Mauro Federico Lopez
 */
public class EgresoUI extends javax.swing.JPanel {

    private EgresoJpaController egresoJpaController;
    private LoteEgresadoTableModel lotesEgresadosTableModel;

    /**
     * Creates new form EgresoUI
     */
    public EgresoUI() {
        initComponents();
        egresoJpaController = new EgresoJpaController();
        lotesEgresadosTableModel = new LoteEgresadoTableModel();
        tablaLotesEgresados.setModel(lotesEgresadosTableModel);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        nuevoLote = new javax.swing.JDialog();
        etiquetaCodigoLote = new javax.swing.JLabel();
        campoCodigoLote = new javax.swing.JTextField();
        etiquetaCantidad = new javax.swing.JLabel();
        campoCantidad = new javax.swing.JFormattedTextField();
        botonGuardarLote = new javax.swing.JButton();
        botonCancelar = new javax.swing.JButton();
        panelCampos = new javax.swing.JPanel();
        etiquetaCodigoEgreso = new javax.swing.JLabel();
        campoCodigoEgreso = new javax.swing.JTextField();
        etiquetaCausaEspecial = new javax.swing.JLabel();
        campoCausaEspecial = new javax.swing.JTextField();
        etiquetaAlmacen = new javax.swing.JLabel();
        campoAlmacen = new javax.swing.JComboBox();
        etiquetaObservaciones = new javax.swing.JLabel();
        jspAreaTexto = new javax.swing.JScrollPane();
        campoObservaciones = new javax.swing.JTextArea();
        jspTabla = new javax.swing.JScrollPane();
        tablaLotesEgresados = new javax.swing.JTable();
        panelBotones = new javax.swing.JPanel();
        botonAgregarLote = new javax.swing.JButton();
        botonQuitarLote = new javax.swing.JButton();
        panelUltimo = new javax.swing.JPanel();
        botonRegistrarEgreso = new javax.swing.JButton();
        botonCancelarEgreso = new javax.swing.JButton();

        nuevoLote.setTitle("Agregar Lote");
        nuevoLote.setMinimumSize(new java.awt.Dimension(259, 97));
        nuevoLote.setResizable(false);

        etiquetaCodigoLote.setText("Código del lote");

        etiquetaCantidad.setText("Cantidad");

        campoCantidad.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.NumberFormatter()));

        botonGuardarLote.setText("Agregar");
        botonGuardarLote.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonGuardarLoteActionPerformed(evt);
            }
        });

        botonCancelar.setText("Cancelar");

        javax.swing.GroupLayout nuevoLoteLayout = new javax.swing.GroupLayout(nuevoLote.getContentPane());
        nuevoLote.getContentPane().setLayout(nuevoLoteLayout);
        nuevoLoteLayout.setHorizontalGroup(
            nuevoLoteLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(nuevoLoteLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(nuevoLoteLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(nuevoLoteLayout.createSequentialGroup()
                        .addGroup(nuevoLoteLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(etiquetaCantidad, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(etiquetaCodigoLote, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(nuevoLoteLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(campoCodigoLote, javax.swing.GroupLayout.DEFAULT_SIZE, 164, Short.MAX_VALUE)
                            .addComponent(campoCantidad)))
                    .addGroup(nuevoLoteLayout.createSequentialGroup()
                        .addGap(42, 42, 42)
                        .addComponent(botonGuardarLote)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(botonCancelar)))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        nuevoLoteLayout.setVerticalGroup(
            nuevoLoteLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(nuevoLoteLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(nuevoLoteLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(campoCodigoLote, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(etiquetaCodigoLote))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(nuevoLoteLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(etiquetaCantidad)
                    .addComponent(campoCantidad, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(nuevoLoteLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(botonGuardarLote)
                    .addComponent(botonCancelar))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Egresar Lotes de Productos", javax.swing.border.TitledBorder.CENTER, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 18))); // NOI18N
        setMaximumSize(new java.awt.Dimension(900, 500));
        setMinimumSize(new java.awt.Dimension(900, 500));
        setLayout(new java.awt.BorderLayout());

        panelCampos.setMaximumSize(new java.awt.Dimension(900, 173));
        panelCampos.setMinimumSize(new java.awt.Dimension(900, 173));

        etiquetaCodigoEgreso.setText("Código");

        etiquetaCausaEspecial.setText("Causa Especial");

        etiquetaAlmacen.setText("Almacén");

        campoAlmacen.setModel(new vistas.modelos.AlmacenComboBoxModel());
        campoAlmacen.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                campoAlmacenItemStateChanged(evt);
            }
        });

        etiquetaObservaciones.setText("Observaciones");

        campoObservaciones.setColumns(20);
        campoObservaciones.setRows(5);
        jspAreaTexto.setViewportView(campoObservaciones);

        javax.swing.GroupLayout panelCamposLayout = new javax.swing.GroupLayout(panelCampos);
        panelCampos.setLayout(panelCamposLayout);
        panelCamposLayout.setHorizontalGroup(
            panelCamposLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelCamposLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(panelCamposLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(panelCamposLayout.createSequentialGroup()
                        .addGroup(panelCamposLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                            .addComponent(etiquetaCausaEspecial, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(etiquetaAlmacen, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(etiquetaCodigoEgreso, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(panelCamposLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(campoAlmacen, 0, 181, Short.MAX_VALUE)
                            .addComponent(campoCausaEspecial)
                            .addComponent(campoCodigoEgreso)))
                    .addGroup(panelCamposLayout.createSequentialGroup()
                        .addComponent(etiquetaObservaciones)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jspAreaTexto, javax.swing.GroupLayout.PREFERRED_SIZE, 181, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(634, Short.MAX_VALUE))
        );
        panelCamposLayout.setVerticalGroup(
            panelCamposLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelCamposLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(panelCamposLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(campoCodigoEgreso, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(etiquetaCodigoEgreso))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(panelCamposLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(campoCausaEspecial, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(etiquetaCausaEspecial))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(panelCamposLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(campoAlmacen, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(etiquetaAlmacen))
                .addGap(7, 7, 7)
                .addGroup(panelCamposLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(etiquetaObservaciones)
                    .addComponent(jspAreaTexto, javax.swing.GroupLayout.PREFERRED_SIZE, 73, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        add(panelCampos, java.awt.BorderLayout.PAGE_START);

        tablaLotesEgresados.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        tablaLotesEgresados.setEnabled(false);
        tablaLotesEgresados.getTableHeader().setReorderingAllowed(false);
        jspTabla.setViewportView(tablaLotesEgresados);

        add(jspTabla, java.awt.BorderLayout.CENTER);

        botonAgregarLote.setText("Agregar Lote");
        botonAgregarLote.setEnabled(false);
        botonAgregarLote.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonAgregarLoteActionPerformed(evt);
            }
        });

        botonQuitarLote.setText("Quitar Lote");
        botonQuitarLote.setEnabled(false);
        botonQuitarLote.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonQuitarLoteActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout panelBotonesLayout = new javax.swing.GroupLayout(panelBotones);
        panelBotones.setLayout(panelBotonesLayout);
        panelBotonesLayout.setHorizontalGroup(
            panelBotonesLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelBotonesLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(panelBotonesLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(botonQuitarLote, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(botonAgregarLote, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        panelBotonesLayout.setVerticalGroup(
            panelBotonesLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelBotonesLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(botonAgregarLote)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(botonQuitarLote)
                .addContainerGap(199, Short.MAX_VALUE))
        );

        add(panelBotones, java.awt.BorderLayout.LINE_START);

        panelUltimo.setMaximumSize(new java.awt.Dimension(900, 33));
        panelUltimo.setMinimumSize(new java.awt.Dimension(900, 33));
        panelUltimo.setPreferredSize(new java.awt.Dimension(900, 33));

        botonRegistrarEgreso.setText("Registrar Egreso");
        botonRegistrarEgreso.setEnabled(false);
        botonRegistrarEgreso.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonRegistrarEgresoActionPerformed(evt);
            }
        });
        panelUltimo.add(botonRegistrarEgreso);

        botonCancelarEgreso.setText("Cancelar Egreso");
        panelUltimo.add(botonCancelarEgreso);

        add(panelUltimo, java.awt.BorderLayout.PAGE_END);
    }// </editor-fold>//GEN-END:initComponents

    private void botonAgregarLoteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_botonAgregarLoteActionPerformed
        nuevoLote.setVisible(true);
        nuevoLote.pack();
    }//GEN-LAST:event_botonAgregarLoteActionPerformed

    private void botonGuardarLoteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_botonGuardarLoteActionPerformed
        try {
            String codigoLote = campoCodigoLote.getText();
            Double cantidad = ((Number) campoCantidad.getValue()).doubleValue();
            egresoJpaController.agregarLote(codigoLote, cantidad);
            ArrayList<LoteEgresado> lotesEgresados = egresoJpaController.getLotesEgresados();
            lotesEgresadosTableModel.setLotesEgresados(lotesEgresados);
            nuevoLote.setVisible(false);
        } catch (Exception ex) {
            JOptionPane.showMessageDialog(null, ex.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);
        }
    }//GEN-LAST:event_botonGuardarLoteActionPerformed

    private void campoAlmacenItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_campoAlmacenItemStateChanged
        if(evt.getStateChange() == ItemEvent.SELECTED) {
            egresoJpaController.setAlmacen((Almacen) campoAlmacen.getSelectedItem());
            botonAgregarLote.setEnabled(true);
            botonQuitarLote.setEnabled(true);
            tablaLotesEgresados.setEnabled(true);
            botonRegistrarEgreso.setEnabled(true);
        }
    }//GEN-LAST:event_campoAlmacenItemStateChanged

    private void botonRegistrarEgresoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_botonRegistrarEgresoActionPerformed
        try {
            String codigo = campoCodigoEgreso.getText();
            String causaEspecial = campoCausaEspecial.getText();
            String observaciones = campoObservaciones.getText();
            egresoJpaController.agregarDatosDelEgreso(codigo, causaEspecial, observaciones);
            egresoJpaController.persistirOperacion();
        } catch (Exception ex) {
            JOptionPane.showMessageDialog(campoCodigoEgreso, ex.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);
        }
    }//GEN-LAST:event_botonRegistrarEgresoActionPerformed

    private void botonQuitarLoteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_botonQuitarLoteActionPerformed
        try {
            int selectedRow = tablaLotesEgresados.getSelectedRow();
            egresoJpaController.eliminarLote(selectedRow);
        } catch (Exception ex) {
            JOptionPane.showMessageDialog(campoCodigoEgreso, ex.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);
        }
    }//GEN-LAST:event_botonQuitarLoteActionPerformed

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton botonAgregarLote;
    private javax.swing.JButton botonCancelar;
    private javax.swing.JButton botonCancelarEgreso;
    private javax.swing.JButton botonGuardarLote;
    private javax.swing.JButton botonQuitarLote;
    private javax.swing.JButton botonRegistrarEgreso;
    private javax.swing.JComboBox campoAlmacen;
    private javax.swing.JFormattedTextField campoCantidad;
    private javax.swing.JTextField campoCausaEspecial;
    private javax.swing.JTextField campoCodigoEgreso;
    private javax.swing.JTextField campoCodigoLote;
    private javax.swing.JTextArea campoObservaciones;
    private javax.swing.JLabel etiquetaAlmacen;
    private javax.swing.JLabel etiquetaCantidad;
    private javax.swing.JLabel etiquetaCausaEspecial;
    private javax.swing.JLabel etiquetaCodigoEgreso;
    private javax.swing.JLabel etiquetaCodigoLote;
    private javax.swing.JLabel etiquetaObservaciones;
    private javax.swing.JScrollPane jspAreaTexto;
    private javax.swing.JScrollPane jspTabla;
    private javax.swing.JDialog nuevoLote;
    private javax.swing.JPanel panelBotones;
    private javax.swing.JPanel panelCampos;
    private javax.swing.JPanel panelUltimo;
    private javax.swing.JTable tablaLotesEgresados;
    // End of variables declaration//GEN-END:variables
}
